---
# ============================================================================
# PostgreSQL: Universal Defaults
# File: group_vars/all/postgresql.yml
# Role: geerlingguy.postgresql
# ============================================================================
#
# This file contains:
# - ROLE: geerlingguy.postgresql public API variables
# - REPO: postgresql_defaults.* (our helper variables)
#
# Variable categories:
# - ROLE variables: Set according to role documentation
# - REPO variables: Our building blocks for database/config management
#
# Consult role documentation:
# https://github.com/geerlingguy/ansible-role-postgresql
#
# Variable precedence:
#   all (this file) → db → hw_* → app → host_vars
# ============================================================================

# --- ROLE: Service Configuration ---
# Socket directory for client connections (required for service startup)
postgresql_unix_socket_directories:
  - /var/run/postgresql

# Service management defaults
postgresql_service_state: started
postgresql_service_enabled: true

# Python library for Ansible PostgreSQL modules
postgresql_python_library: python3-psycopg2

# PostgreSQL user and group
postgresql_user: postgres
postgresql_group: postgres

# --- REPO: Universal Defaults ---
# Repository-defined defaults used across all database operations
postgresql_defaults:
  # Database creation defaults
  # Used by application-level configs (n8n, nextcloud, etc.)
  # Ensures consistent locale/encoding across all databases
  db:
    lc_collate: "en_US.UTF-8" # Collation (sort order for strings)
    lc_ctype: "en_US.UTF-8" # Character classification (UPPER/LOWER behavior)
    encoding: "UTF-8" # Character encoding (universal support)
    template: "template0" # Clean template (allows encoding override)

  # Base configuration (merged with hardware/app-specific settings)
  # These are required by the role and must be present in final config
  config_base:
    # Required: Socket location (PostgreSQL ≥ 9.3 uses plural form)
    - option: unix_socket_directories
      value: '{{ postgresql_unix_socket_directories | join(",") }}'

    # Recommended: Explicit log directory (role creates with correct permissions)
    - option: log_directory
      value: "log"
